'use strict';

const nunjucks = require('./nunjucks-no-chokidar');
const utils = require('./utils/');

function Require(options) {
  this.tags = ['require'];

  this.parse = function(parser, nodes) {
    const tok = parser.nextToken();
    const args = parser.parseSignature(null, true);
    parser.advanceAfterBlockEnd(tok.value);
    return new nodes.CallExtension(this, 'run', args, null);
  };

  this.run = (options || {}).run || function(context, path) {
    let html = '';
    if (utils.isScriptFile(path)) {
      html = '<script crossorigin="anonymous" type="text/javascript" src="' + path.replace(utils.RE_SCRIPT, '.js') + '"></script>';
    } else if (utils.isStyleFile(path)) {
      html = '<link charset="utf-8" rel="stylesheet" type="text/css" href="' + path.replace(utils.RE_STYLE, '.css') + '" />';
    }
    return new nunjucks.runtime.SafeString(html);
  };
}

/* global module */
module.exports = Require;
