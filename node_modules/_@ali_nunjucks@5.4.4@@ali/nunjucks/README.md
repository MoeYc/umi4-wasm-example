nunjucks
=======

[![TNPM version][tnpm-image]][tnpm-url]
[![TNPM downloads][tnpm-downloads-image]][tnpm-url]

[tnpm-image]: http://web.npm.alibaba-inc.com/badge/v/@ali/nunjucks.svg?style=flat-square
[tnpm-url]: http://web.npm.alibaba-inc.com/package/@ali/nunjucks
[tnpm-downloads-image]: http://web.npm.alibaba-inc.com/badge/d/@ali/nunjucks.svg?style=flat-square

更加安全的 nunjucks，并且不会依赖 fevents。

**从 3.0.0 开始，不再支持 `node@0.x`，请不要在 node 低版本运行。**

## Install

```bash
$ tnpm install @ali/nunjucks --save
```

## Usage

```js
const nunjucks = require('@ali/nunjucks');

const env = new nunjucks.Environment(loader);
```

### 默认 `autoescape = true`

默认开启 `escape`，严格模式。

### 更安全的 `escape`

会替换 5 个特殊字符：

```js
'&': '&amp;',
'"': '&quot;',
'<': '&lt;',
'>': '&gt;',
'\'': '&#x27;'
```

### 生产环境忽略不存在的 filter

为了防止动态发布模板新增 filter 导致的异常，

在生产环境 `NODE_ENV === 'production'`,
如果发现 filter 不存在，则只会打印一个 `logger.error(err)`, 而不抛异常。

```html
{{ name | notexists }}
```

### require 标签

模板支持 `{% require "index.js" %}` 语法，支持自动引入入口 JavaScript 和 CSS
文件，支持的入口文件类型包括：

* *.js
* *.jsx
* *.coffee
* *.css
* *.less
* *.styl
* *.scss
* *.sass

默认一个 `{% require %}` 输出一个静态资源入口文件的 HTML 代码，例如：

```html
{% require "index.js" %}
{% require "index.css" %}
```

输出 HTML 为

```html
<script type="text/javascript" src="index.js"></script>
<link charset="utf-8" rel="stylesheet" type="text/css" href="index.css" />
```

@ali/nunjucks 还提供了将多个 require 的入口文件合并输出、及线上文件映射的功能。

```js
const resourceMap = {
  "base,index,face.css": "base,index,face-hashA3B4.css",
  "common,tracker,index.js": "common,tracker,index-hashC5D6.js"
};
function resolve(resourceList, type) {
  return '/' + package.name + '/app/' +
    resourceList.join(',') +
    (type === 'javascript' ? '.js' : 'css');
}
function locals(local) {
  return '<script>window.context = ' + JSON.stringify(local) + ';</script>';
}

const envCombinMap = new nunjucks.Environment(loader, {
  resource: {
    combine: true,
    cache: true,
    resoule: resolve,
    locals: locals,
    map: resourceMap
  }
});
```

## Contributors(7)

Ordered by date of first contribution, by [ali-contributors](http://gitlab.alibaba-inc.com/node/ali-contributors).

- ![](https://work.alibaba-inc.com/photo/43624.30x30.jpg) [@苏千](https://fengmk2.com)<a target="_blank" href="http://amos.im.alisoft.com/msg.aw?v=2&site=cntaobao&s=2&charset=utf-8&uid=%E8%8B%8F%E5%8D%83"><img src="http://amos.alicdn.com/online.aw?v=2&uid=%E8%8B%8F%E5%8D%83&site=cntaobao&s=1&charset=utf-8"></a>
- ![](https://work.alibaba-inc.com/photo/52624.30x30.jpg) [@不四](http://deadhorse.me)<a target="_blank" href="http://amos.im.alisoft.com/msg.aw?v=2&site=cntaobao&s=2&charset=utf-8&uid=%E4%B8%8D%E5%9B%9B"><img src="http://amos.alicdn.com/online.aw?v=2&uid=%E4%B8%8D%E5%9B%9B&site=cntaobao&s=1&charset=utf-8"></a>
- ![](https://work.alibaba-inc.com/photo/28761.30x30.jpg) [@贯高](http://chuo.me)<a target="_blank" href="http://amos.im.alisoft.com/msg.aw?v=2&site=cntaobao&s=2&charset=utf-8&uid=%E8%B4%AF%E9%AB%98"><img src="http://amos.alicdn.com/online.aw?v=2&uid=%E8%B4%AF%E9%AB%98&site=cntaobao&s=1&charset=utf-8"></a>
- ![](https://work.alibaba-inc.com/photo/49642.30x30.jpg) [@冒顿](http://hotoo.me)<a target="_blank" href="http://amos.im.alisoft.com/msg.aw?v=2&site=cntaobao&s=2&charset=utf-8&uid=%E5%86%92%E9%A1%BF"><img src="http://amos.alicdn.com/online.aw?v=2&uid=%E5%86%92%E9%A1%BF&site=cntaobao&s=1&charset=utf-8"></a>
- ![](https://work.alibaba-inc.com/photo/39967.30x30.jpg) [@余化](http://shaoshuai.me)<a target="_blank" href="http://amos.im.alisoft.com/msg.aw?v=2&site=cntaobao&s=2&charset=utf-8&uid=%E4%BD%99%E5%8C%96"><img src="http://amos.alicdn.com/online.aw?v=2&uid=%E4%BD%99%E5%8C%96&site=cntaobao&s=1&charset=utf-8"></a>
- ![](https://work.alibaba-inc.com/photo/70088.30x30.jpg) [@啸生](https://work.alibaba-inc.com/work/u/70088)<a target="_blank" href="http://amos.im.alisoft.com/msg.aw?v=2&site=cntaobao&s=2&charset=utf-8&uid=%E5%95%B8%E7%94%9F"><img src="http://amos.alicdn.com/online.aw?v=2&uid=%E5%95%B8%E7%94%9F&site=cntaobao&s=1&charset=utf-8"></a>
- ![](https://work.alibaba-inc.com/photo/72999.30x30.jpg) [@济滇](https://work.alibaba-inc.com/work/u/72999)<a target="_blank" href="http://amos.im.alisoft.com/msg.aw?v=2&site=cntaobao&s=2&charset=utf-8&uid=%E6%B5%8E%E6%BB%87"><img src="http://amos.alicdn.com/online.aw?v=2&uid=%E6%B5%8E%E6%BB%87&site=cntaobao&s=1&charset=utf-8"></a>

---
[![CoffeePay 打赏](http://coffee.alibaba-inc.com/projects/586249f5a462c443f57ec2f6/badge)](http://coffee.alibaba-inc.com/donates?id=586249f5a462c443f57ec2f6)
欢迎打赏一杯咖啡~
<br>
<img width="150" src="http://coffee.alibaba-inc.com/projects/586249f5a462c443f57ec2f6/qr">


--------------------
