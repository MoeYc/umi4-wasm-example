# 不要修改该文件，会自动生成，详见 https://gitlab.alibaba-inc.com/node/ci

stage:
{%- for item in versions %}
  {{item.pipeline}}:
    env:
      {{item.env}}
    plugin:
      -
        param:
          url: '${repo}'
          branch: '${branch}'
          path: '${source_root}'
          isDelGit: 'false'
        name: checkout
        pos: front
      -
        param:
          version: {{item.nodeVersion}}
          source: '${source_root}'
          {%- if cpp %}
          cpp: 'true'
          {%- endif %}
        name: node_envs
        pos: front
    exec:
      - 'export PATH=$PWD/node_modules/.bin:$HOME/.cli:$PATH'
      - 'echo $PATH'
{%- if beforeShell %}
{%- for shell in beforeShell %}
      - '{{shell}}'
{%- endfor %}
{%- endif %}
{%- if item.coverageReport %}
      - 'EXIT_CODE=0 && {{item.scripts.ci}} || EXIT_CODE=1 && {{item.coverageReport}} && exit $EXIT_CODE'
{%- else %}
      - '{{item.scripts.ci}}'
{%- endif %}
{%- endfor %}
pipeline:
{%- for pipeline in pipelines %}
  - '{{pipeline}}'
{%- endfor %}
